services:
  web:
    build: .
    container_name: shopee_web
    volumes:
      - ./uploads:/app/uploads
      - ./outputs:/app/outputs
      - ./logs:/app/logs
      - ./instance:/app/instance
    ports:
      - "8000:8000"
    environment:
      # Secrets (provided at deploy time via .env / environment)
      OPEN_API_KEY: ${OPEN_API_KEY}
      NOTION_INTEGRATION_TOKEN: ${NOTION_INTEGRATION_TOKEN}
      NOTION_PAGE_ID: ${NOTION_PAGE_ID}
      SENTRY_DSN: ${SENTRY_DSN}
      SHOPEE_USERNAME: ${SHOPEE_USERNAME}
      SHOPEE_PASSWORD: ${SHOPEE_PASSWORD}
      # App config vars
      FLASK_APP: ${FLASK_APP}
      FLASK_ENV: ${FLASK_ENV}
      FLASK_DEBUG: ${FLASK_DEBUG}
      SECRET_KEY: ${SECRET_KEY}
    restart: always

  nginx:
    image: nginx:latest
    container_name: shopee_nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      # 如果日後上線再改成：
      # - ./nginx/nginx_https.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - web